# 1.5. Implementación de bases de datos ([↑](README.md))

_Contenido creado por Manuel Ignacio López Quintero_

La **implementación de bases de datos**, también conocida como diseño físico, es la fase en la que se traduce el modelo lógico de la base de datos en una estructura física en un Sistema Gestor de Bases de Datos (**SGBD**). En esta etapa se definen las estructuras de almacenamiento y los métodos de acceso, lo cual implica la creación de tablas, claves foráneas y restricciones de integridad. Actualmente, la herramienta más utilizada para la implementación de bases de datos es **SQL**, que permite implementar un modelo relacional de manera eficiente y efectiva.

Para implementar una base de datos relacional previamente modelada, se utilizan diversos comandos de SQL. A continuación, se describen algunos de los comandos más importantes.

El elemento central para implementar una base de datos en SQL es la **creación de tablas**. Se utiliza el comando `CREATE TABLE` para definir una tabla, especificando sus columnas y tipos de datos:

```sql
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    correo VARCHAR(100) UNIQUE,
    fecha_registro DATE
);
````

En este ejemplo, se crea una tabla llamada `usuarios` con cuatro columnas: `id`, `nombre`, `correo` y `fecha_registro`.
La columna `id` es la clave primaria y se autoincrementa, `nombre` es una cadena de hasta 50 caracteres y no puede ser nula, `correo` es una cadena de hasta 100 caracteres y debe ser única, y `fecha_registro` es de tipo fecha.

Las **claves foráneas** se utilizan para establecer relaciones entre tablas, garantizando la integridad referencial:

```sql
CREATE TABLE pedidos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT,
    fecha_pedido DATE,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);
```

En este ejemplo, se crea una tabla `pedidos` con una columna `usuario_id` que es una clave foránea referenciando la columna `id` de la tabla `usuarios`.
Esto asegura que cada pedido esté asociado a un usuario existente, permitiendo una relación de **uno a varios (1:N)** entre `usuarios` y `pedidos`.

Para manejar relaciones **varios a varios (N:M)**, se crea una tabla intermedia que contiene las claves foráneas de ambas tablas relacionadas:

```sql
CREATE TABLE usuario_rol (
    usuario_id INT,
    rol_id INT,
    PRIMARY KEY (usuario_id, rol_id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    FOREIGN KEY (rol_id) REFERENCES roles(id)
);
```

En este ejemplo, se crea una tabla intermedia `usuario_rol` para gestionar la relación entre `usuarios` y `roles`.
La clave primaria compuesta asegura que no haya duplicados en la combinación de `usuario_id` y `rol_id`.

Para definir los diferentes **roles** en la base de datos, se crea una tabla `roles`:

```sql
CREATE TABLE roles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE
);
```

En este ejemplo, se crea una tabla llamada `roles` con dos columnas: `id` y `nombre`.
La columna `id` es la clave primaria y se autoincrementa, y `nombre` es una cadena de hasta 50 caracteres que debe ser única y no puede ser nula.

## Inserción de datos

Para **insertar datos** en una tabla se utiliza el comando `INSERT INTO`:

```sql
INSERT INTO usuarios (nombre, correo, fecha_registro) 
VALUES ('Juan Pérez', 'juan.perez@example.com', '2024-05-14');
```

Este comando inserta un nuevo registro en la tabla `usuarios` con el nombre `Juan Pérez`, correo `juan.perez@example.com`, y fecha de registro `2024-05-14`.

## Actualización de datos

Para **actualizar datos** existentes, se utiliza el comando `UPDATE`:

```sql
UPDATE usuarios 
SET correo = 'juan.perez@nuevoemail.com' 
WHERE id = 1;
```

Este comando actualiza el correo del usuario con `id` igual a `1`.

## Eliminación de datos

Para **eliminar datos** de una tabla, se utiliza el comando `DELETE`:

```sql
DELETE FROM usuarios WHERE id = 1;
```

Este comando elimina el registro del usuario con `id` igual a `1`.

## Consultas

Para realizar **consultas** y recuperar datos de la base de datos, se utiliza el comando `SELECT`:

```sql
SELECT nombre, correo 
FROM usuarios 
WHERE fecha_registro > '2024-01-01';
```

Este comando selecciona y muestra el nombre y correo de los usuarios que se registraron después del 1 de enero de 2024.

## Ejemplo de un modelo implementado en SQL

```sql
CREATE TABLE viajeros (
    id INT PRIMARY KEY,
    nombre VARCHAR(100),
    teléfono VARCHAR(15)
);

CREATE TABLE pasaportes (
    id INT PRIMARY KEY,
    país VARCHAR(50),
    fecha_expiración DATE,
    viajero_id INT UNIQUE NOT NULL,
    FOREIGN KEY (viajero_id) REFERENCES viajeros(id)
);

CREATE TABLE reservas (
    id INT PRIMARY KEY,
    fecha_registro DATE,
    estado_actual VARCHAR(50),
    viajero_id INT NOT NULL,
    FOREIGN KEY (viajero_id) REFERENCES viajeros(id)
);

CREATE TABLE vuelos (
    id INT PRIMARY KEY,
    fecha_salida DATE,
    destino VARCHAR(100)
);

CREATE TABLE reserva_vuelo (
    reserva_id INT,
    vuelo_id INT,
    clase_servicio VARCHAR(20),
    PRIMARY KEY (reserva_id, vuelo_id),
    FOREIGN KEY (reserva_id) REFERENCES reservas(id),
    FOREIGN KEY (vuelo_id) REFERENCES vuelos(id)
);
```

## Ejercicio

A partir del modelo relacional presentado en el ejercicio resuelto de la sección anterior, impleméntalo utilizando SQL.

### Propuesta de solución (ve esta propuesta únicamente después de resolver el ejercicio por ti mismo)

A continuación, se presenta una propuesta de implementación utilizando SQL:

```sql
CREATE TABLE alumnos (
    id INT PRIMARY KEY,
    nombre VARCHAR(100),
    correo_electrónico VARCHAR(100)
);

CREATE TABLE profesores (
    id INT PRIMARY KEY,
    nombre VARCHAR(100),
    especialidad VARCHAR(100)
);

CREATE TABLE asignaturas (
    id INT PRIMARY KEY,
    nombre VARCHAR(100),
    créditos INT,
    profesor_id INT,
    FOREIGN KEY (profesor_id) REFERENCES profesores(id)
);

CREATE TABLE alumno_asignatura (
    alumno_id INT,
    asignatura_id INT,
    año_académico INT,
    PRIMARY KEY (alumno_id, asignatura_id),
    FOREIGN KEY (alumno_id) REFERENCES alumnos(id),
    FOREIGN KEY (asignatura_id) REFERENCES asignaturas(id)
);
```

_Contenido creado por Manuel Ignacio López Quintero_
