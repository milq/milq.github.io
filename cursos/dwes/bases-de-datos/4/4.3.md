# 4.3. Obtención y manejo de resultados ([↑](README.md))

_Contenido creado por Manuel Ignacio López Quintero_

La **obtención y manejo de resultados** en PHP utilizando PDO son tareas fundamentales en el desarrollo de aplicaciones que interactúan con bases de datos. La **obtención de resultados** se puede realizar de diversas maneras, utilizando métodos como `fetchAll`, `fetch` y `fetchColumn`. Cada uno de estos métodos permite obtener los datos de la base de datos de forma eficiente y luego **manejar los resultados** según las necesidades específicas de la aplicación.

Para **obtener todas las filas** de una consulta, se utiliza el método `fetchAll`, que devuelve un ***array* bidimensional** con el conjunto de resultados. Por defecto, `fetchAll` usa `PDO::FETCH_BOTH`, lo que significa que las filas se representan tanto con índices numéricos como asociativos. A continuación, se muestra cómo realizar esto en PHP:

```php
require 'connect_db.php';

try {
    $sth = $pdo->prepare('SELECT * FROM usuarios');
    $sth->execute();
    $results = $sth->fetchAll(); // PDO::FETCH_BOTH por defecto

    print_r($results);
} catch (PDOException $e) {
    echo 'Error: ' . $e->getMessage();
}
```

Para **obtener una única fila** de una consulta en un ***array* unidimensional**, se emplea el método `fetch`. Este método es útil cuando se espera un único resultado o cuando se quiere procesar filas una por una en un bucle. Utilizar `PDO::FETCH_NUM` permite obtener los resultados como un *array* indexado numéricamente. Sin embargo, con `PDO::FETCH_ASSOC`, las filas se representan solo con índices asociativos, es decir, los nombres de las columnas. El siguiente código PHP demuestra su uso:

```php
require 'connect_db.php';

try {
    $sth = $pdo->prepare('SELECT * FROM usuarios WHERE id = 1');
    $sth->execute();
    $result = $sth->fetch(PDO::FETCH_ASSOC); // PDO::FETCH_BOTH por defecto

    print_r($result);
} catch (PDOException $e) {
    echo 'Error: ' . $e->getMessage();
}
```

Para **obtener un solo valor de una columna específica**, se emplea el método `fetchColumn`. Este método es ideal cuando se necesita obtener un único dato, como el resultado de una agregación o una columna específica de una fila. A continuación, se muestra un ejemplo de su uso:

```php
require 'connect_db.php';

try {
    $sth = $pdo->prepare('SELECT nombre FROM usuarios WHERE id = 1');
    $sth->execute();
    $nombre = $sth->fetchColumn();

    echo 'El nombre es: ' . htmlspecialchars($nombre);
} catch (PDOException $e) {
    echo 'Error: ' . $e->getMessage();
}
```

Una vez obtenidos los datos, podemos **manejar los resultados** de diversas maneras, una de las cuales es **presentarlos de forma visual**. Para ello, se puede crear una tabla HTML que muestre todos los datos obtenidos de una tabla de la base de datos. A continuación, se presentan dos ejemplos sencillos.

Para conjuntos de datos más pequeños o cuando necesitas todos los datos a la vez, `fetchAll()` puede ser más conveniente:

```php
require 'connect_db.php';

try {
    $sth = $pdo->prepare('SELECT nombre, alias, fecha_registro FROM usuarios');
    $sth->execute();
    $results = $sth->fetchAll(PDO::FETCH_ASSOC);

    echo '<table border="1">';
    echo '<tr><th>Nombre</th><th>Alias</th><th>Fecha de Registro</th></tr>';
    foreach ($results as $fila) {
        echo '<tr>';
        echo '<td>' . htmlspecialchars($fila['nombre']) . '</td>';
        echo '<td>' . htmlspecialchars($fila['alias']) . '</td>';
        echo '<td>' . htmlspecialchars($fila['fecha_registro']) . '</td>';
        echo '</tr>';
    }
    echo '</table>';
} catch (PDOException $e) {
    echo 'Error: ' . $e->getMessage();
}
```

Para grandes conjuntos de datos, `fetch()` es más eficiente en términos de memoria y debe ser la elección preferida:

```php
require 'connect_db.php';

try {
    $sth = $pdo->prepare('SELECT nombre, alias, fecha_registro FROM usuarios');
    $sth->execute();

    echo '<table border="1">';
    echo '<tr><th>Nombre</th><th>Alias</th><th>Fecha de Registro</th></tr>';
    while ($fila = $sth->fetch(PDO::FETCH_ASSOC)) {
        echo '<tr>';
        echo '<td>' . htmlspecialchars($fila['nombre']) . '</td>';
        echo '<td>' . htmlspecialchars($fila['alias']) . '</td>';
        echo '<td>' . htmlspecialchars($fila['fecha_registro']) . '</td>';
        echo '</tr>';
    }
    echo '</table>';
} catch (PDOException $e) {
    echo 'Error: ' . $e->getMessage();
}
```

_Contenido creado por Manuel Ignacio López Quintero_
